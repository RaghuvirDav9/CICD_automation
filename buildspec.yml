version: 0.2
run-as: codebuild-user
phases:
  install:
    commands:
      - sudo yum install docker -y
  pre_build:
    commands:
      - docker build -t dockerdemo .
      - docker tag dockerdemo:latest 183650099165.dkr.ecr.ap-south-1.amazonaws.com/dockerdemo:latest
      - docker push 183650099165.dkr.ecr.ap-south-1.amazonaws.com/dockerdemo:latest
      - echo 'in install phase'
      - echo 'in pre build phase'
    finally:
      - echo 'in finally of prebuild phase'
  build:
    commands:
      - echo 'in build phase'
      - ls -la
  post_build:
    run-as: root
    commands:
      - whoami
      - echo 'in post build phase'
    finally:
      - ls -la